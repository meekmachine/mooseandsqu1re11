var Emotion={Anger:0,Contempt:1,Disgust:2,Embarrassment:3,Fear:4,Happiness:5,Pride:6,Sadness:7,Surprise:8},AUNames={AU1:0,AU2:1,AU4:2,AU5:3,AU6:4,AU7:5,AU8:6,AU9:7,AU10:8,AU11:9,AU12:10,AU13:11,AU14:12,AU15:13,AU16:14,AU17:15,AU18:16,AU20:17,AU22:18,AU23:19,AU24:20,AU25:21,AU26:22,AU27:23,AU28:24,AU38:25,AU39:26,AU41:27,AU42:28,AU43:29,AU44:30,AU45:31,AU46:32,AU51:33,AU52:34,TOTAL:35},ModuleType={Sensor:0,Processor:1,Effector:2,Dummy:3,Unknown:-1},CounselorAction={Sit:0,L_HandRest:1,L_FormlessFlick:2,
L_FingerTap:3,L_Point:4,L_Wave:5,R_HandRest:6,R_FormlessFlick:7,R_FingerTap:8,R_Point:9,R_Wave:10,Contrast:11,OpenHands:12,Idle_CollarHead:13,Head_Nod:14,length:15},UserCommandID={GO_TO_PREVIOUS_QUESTION:0,RESET_ANSWER:1,YES:2,NO:3};jQuery(function(b){jQuery.cachedScript=function(a,c){c=b.extend(c||{},{dataType:"script",cache:!1,url:a});return jQuery.ajax(c)}});
function loadScript(b,a){var c=document.createElement("script");c.type="text/javascript";c.readyState?c.onreadystatechange=function(){if("loaded"==c.readyState||"complete"==c.readyState)c.onreadystatechange=null,a()}:c.onload=function(){a()};c.src=b;document.body.appendChild(c)}
var ModuleDependency=Class.create({initialize:function(b,a,c){this.dir=b;this.name=a;this.module=c;this.pending=!1},equals:function(b){return this.name==b.name}}),Mainframe=Class.create({initialize:function(b){var a=this;a.manager=new THREE.LoadingManager;a.manager.onProgress=a.managerOnProgress.bind(this);a.manager.onLoad=a.managerOnLoad.bind(this);a.manager.onError=a.managerOnError.bind(this);a.manager.onStart=a.managerOnStart.bind(this);a.finishedLoading=!1;a.hasSomethingToLoad=!1;a.config=b;a.configurationCompatible=
!1;a.registeredModules=[];a.registeredResources=[];a.requiredResources=[];a.moduleExecutionOrder=[];a.loadedModules=[];a.loadedModuleDependencies=[];jQuery(function(c){jQuery.get(b,function(b){jQuery(b).find("module").each(function(){var b=jQuery(this),c=b.attr("name"),b=b.attr("uri");a.registerModule(c,b)})})})},managerOnProgress:function(b,a,c){console.log(b,a,c)},managerOnLoad:function(){console.log("/-/-/-/-/-/-/-/-/-/-/-/-/-/-/ all items loaded /-/-/-/-/-/-/-/-/-/-/-/-/-/-/");this.finishedLoading=
!0;jQuery(function(b){b(".onepix-imgloader").fadeOut();b(".loading-container > *:not(.onepix-imgloader)").fadeTo(8E3,100)})},managerOnError:function(){console.log("there has been an error");void 0!=this.manager.scope&&(this.manager.scope.isLoading=!1)},managerOnStart:function(){this.hasSomethingToLoad=!0},registerModule:function(b,a){var c=this;if(-1<c.moduleRegistered(b))console.log("Module "+b+" already registered !");else{var d=c.moduleLoaded(b);if(-1==d)jQuery(function(d){d.cachedScript(config.moduleDirectory+
a+"/dependencies.js").done(function(d,e){c.registerModule_lazy.delay(0.1,c,b,a)})});else{var e=c.verifyDuplicateResourceInModuleRegistration(this.loadedModules[d]);if(null==e){c.registeredModules.push(c.loadedModules[d]);for(d=0;d<newModule.providedResources.length;++d)c.registeredResources.push(newModule.providedResources[d]);console.log("Load module "+b+": registered from memory (previously loaded)");c.verifyModuleCompatibility();newModule.setActive(!0)}else console.log("Module "+b+" provides at least one duplicate resource: "+
e)}}},registerModule_lazy:function(b,a,c){if(-1<b.moduleRegistered(a))console.log("Module "+a+" already registered !");else{for(var d=!0,e=0;e<b.loadedModuleDependencies.length;++e)b.loadedModuleDependencies[e].pending&&(d=!1);d?jQuery(function(d){d.cachedScript(config.moduleDirectory+c+"/main.js").done(function(c,d){if(-1<b.moduleRegistered(a))console.log("Module "+a+" already registered !");else{var e=new window[a],f=b.verifyDuplicateResourceInModuleRegistration(e);if(null==f){b.registeredModules.push(e);
for(f=0;f<e.providedResources.length;++f)b.registeredResources.push(e.providedResources[f]);b.verifyModuleCompatibility();e.setActive(!0);console.log("Load module "+a+": "+d)}else console.log("Module "+a+" provides at least one duplicate resource: "+f)}})}):(console.log("waiting for dependencies..."),b.registerModule_lazy.delay(0.1,b,a,c))}},unregisterModule:function(b){b=this.moduleRegistered(b);if(-1!=b){this.registeredModules[b].setActive(!1);this.registeredModules[b].cleanup();for(var a=0;a<this.registeredModules[b].providedResources.length;++a){var c=
this.providedResourceRegistered(this.registeredModules[b].providedResources[a]);this.registeredResources.splice(c,1)}this.registeredModules.splice(b,1)}},verifyDuplicateResourceInModuleRegistration:function(b){for(var a=null,c=0;c<b.providedResources.length;++c){for(var d=0;d<this.registeredResources.length;++d)b.providedResources[c].name==this.registeredResources[d].name&&(a=b.providedResources[c].name);if(null!=a)break}return a},verifyModuleCompatibility:function(){this.configurationCompatible=
!1;for(var b=!0,a=0;a<this.registeredModules.length;++a){for(var c=0;c<this.registeredModules[a].requiredResources.length;++c){for(var d=!1,e=0;e<this.registeredResources.length;++e)this.registeredModules[a].requiredResources[c].name==this.registeredResources[e].name&&(this.registeredModules[a].requiredResources[c].container=this.registeredResources[e].container,d=!0);if(!d)if(this.registeredModules[a].isResourceOptional(this.registeredModules[a].requiredResources[c]))console.log("Resource "+this.registeredModules[a].requiredResources[c].name+
" not found, but is optional for module "+this.registeredModules[a].name+".");else{b=!1;console.log("Could not find resource "+this.registeredModules[a].requiredResources[c].name+" required by module "+this.registeredModules[a].name+".");break}}if(!b)break}if(b){console.log("AbstractModule configuration OK !");console.log("Performing cleanup...");for(a=0;a<this.registeredModules.length;++a)this.registeredModules[a].cleanup();this.updateModuleExecutionOrder()}else console.log("Incompatible module configuration !");
this.configurationCompatible=b},updateModuleExecutionOrder:function(){var b=this.registeredModules.slice(),a=[];this.moduleExecutionOrder=[];for(var c=!0;c;)for(var c=!1,d=0;d<b.length;++d){for(var e=!0,f=0;f<b[d].requiredResources.length;++f){var g=!1;if(b[d].isResourceOptional(b[d].requiredResources[f]))g=!0;else for(var h=0;h<a.length;++h)if(b[d].requiredResources[f].name==a[h].name){g=!0;break}if(!g){e=!1;break}}if(e){this.moduleExecutionOrder.push(b[d]);for(f=0;f<b[d].providedResources.length;++f)a.push(b[d].providedResources[f]);
b.splice(d,1);d--;c=!0}}if(0<b.length){console.log("Terrible error in updateModuleExecutionOrder() - modules still remaining after sweep !");for(d=0;d<b.length;++d)console.log("> "+b[d].name)}else{console.log("Computed new module execution order !");for(d=0;d<this.moduleExecutionOrder.length;++d)console.log(d+": "+this.moduleExecutionOrder[d].name)}},moduleLoaded:function(b){for(var a=0;a<this.loadedModules.length;++a)if(this.loadedModules[a].name==b)return a;return-1},moduleRegistered:function(b){for(var a=
0;a<this.registeredModules.length;++a)if(this.registeredModules[a].name==b)return a;return-1},providedResourceRegistered:function(b){for(var a=0;a<this.registeredResources.length;++a)if(this.registeredResources[a]==b)return a;return-1},addModuleDependency:function(b){for(var a=!1,c=0;c<this.loadedModuleDependencies.length;++c)if(this.loadedModuleDependencies[c].equals(b)){a=!0;console.log("Dependency already loaded");break}a?console.log("Dependency "+b.scriptName+" of "+b.clientModule+" module already loaded ! If this is a name coincidence, please rename your dependency."):
(b.pending=!0,this.loadedModuleDependencies.push(b),loadScript(b.dir+"/"+b.name,function(){b.pending=!1;console.log("Dependency loaded by "+b.module+" module: "+b.name)}))},run:function(){requestAnimationFrame(this.run.bind(this));if((this.finishedLoading||!this.hasSomethingToLoad)&&this.configurationCompatible){console.log("Mainframe running...");for(var b=0;b<this.moduleExecutionOrder.length;++b)this.moduleExecutionOrder[b].run()}}}),Module=Class.create({initializem:function(){this.name="unknown";
this.type=ModuleType.Unknown;this.active=this.mandatory=!1;this.requiredResources=[];this.providedResources=[];this.optionalResources=[]},setActive:function(b){this.active=!0},isResourceOptional:function(b){for(var a=0;a<this.optionalResources.length;++a)if(void 0!=this.optionalResources[a]&&b.name==this.optionalResources[a].name)return!0;return!1},cleanup:function(){},run:function(){console.log("WARNING: Default run method used !")}}),Resource=Class.create({initializer:function(){this.name="unknown";
this.container={}}}),FacialExpression=Class.create(Resource,{initialize:function($super){$super();this.name="FacialExpression";this.container.data={};this.container.data[Emotion.Anger]=0;this.container.data[Emotion.Contempt]=0;this.container.data[Emotion.Disgust]=0;this.container.data[Emotion.Embarrassment]=0;this.container.data[Emotion.Fear]=0;this.container.data[Emotion.Happiness]=0;this.container.data[Emotion.Pride]=0;this.container.data[Emotion.Sadness]=0;this.container.data[Emotion.Surprise]=
0}}),UserFacialExpression=Class.create(FacialExpression,{initialize:function($super){$super();this.name="UserFacialExpression"}}),CharacterFacialExpression=Class.create(FacialExpression,{initialize:function($super){$super();this.name="CharacterFacialExpression"}}),Text=Class.create(Resource,{initialize:function($super){$super();this.name="Text";this.container.text="";this.container.timestamp=0}}),UserText=Class.create(Text,{initialize:function($super){$super();this.name="UserText"}}),InterimUserText=
Class.create(Text,{initialize:function($super){$super();this.name="InterimUserText"}}),PosText=Class.create(Resource,{initialize:function($super){$super();this.name="PosText";this.container.text=[];this.container.pos=[]}}),SentimentText=Class.create(Resource,{initialize:function($super){$super();this.name="Sentiment";this.container.sentiment=[]}}),CharacterText=Class.create(Text,{initialize:function($super){$super();this.name="CharacterText"}}),VideoStream=Class.create(Resource,{initialize:function($super){$super();
this.name="VideoStream";this.container.videoStream=null}}),Mesh3D=Class.create(Resource,{initialize:function($super){$super();this.name="Mesh3D";this.container.mesh=null;this.container.pending=!0;this.container.visible=!1;this.container.timestamp=0;this.container.animations=[];this.container.mixer=null}}),CharacterAudioStream=Class.create(Resource,{initialize:function($super){$super();this.name="CharacterAudioStream";this.container.audioStream=null;this.container.visemes=null;this.container.bookmarks=
null;this.container.timestamp=0}}),InterviewQA=Class.create(Resource,{initialize:function($super){$super();this.name="InterviewQA";this.container.questionId=0;this.container.question="";this.container.answers=[]}}),UserInterviewChoice=Class.create(Resource,{initialize:function($super){$super();this.name="UserInterviewChoice";this.container.choice=-1;this.container.isHint=!1;this.container.isVolume=!1;this.container.understood=!1;this.container.timestamp=0}}),CharacterIsSpeaking=Class.create(Resource,
{initialize:function($super){$super();this.name="CharacterIsSpeaking";this.container.speaking=!1}}),CharacterIsListening=Class.create(Resource,{initialize:function($super){$super();this.name="CharacterIsListening";this.container.listening=!1}}),TreeValence=Class.create(Resource,{initialize:function($super){$super();this.name="TreeValence";this.container.questionValence="";this.container.answerValence="";this.container.scoreValence="";this.container.lastTime=0;this.container.currentTime=0}}),DecisionTree=
Class.create(Resource,{initialize:function($super){$super();this.name="DecisionTree";this.container.behavior=[]}}),InterviewRiskScore=Class.create(Resource,{initialize:function($super){$super();this.name="InterviewRiskScore";this.container.riskScore=0}}),CharacterAction=Class.create({initialize:function(){self.active=!1;self.timeScale=1}}),CharacterActions=Class.create(Resource,{initialize:function($super){$super();this.name="CharacterActions";this.container.actions=[];for(var a=0;a<CounselorAction.length;++a)this.container.actions.push(new CharacterAction)}}),
CharacterEyeGaze=Class.create(Resource,{initialize:function($super){$super();this.name="ChracterEyeGaze";this.container.vdir=0;this.container.hdir=0},getMorphTargetValues:function(){var b=0,a=0,c=0,d=0;0<=this.container.vdir?b=this.container.vdir:a=-this.container.vdir;0<=this.container.hdir?c=this.container.hdir:d=-this.container.hdir;return[b,a,c,d]}}),CharacterVoice=Class.create(Resource,{initialize:function($super){$super();this.name="CharacterVoice";this.container.voice=0}}),SelectedCharacterInfo=
Class.create(Resource,{initialize:function($super){$super();this.name="SelectedCharacterInfo";this.container.modName="";this.container.uri="";this.container.friendlyName="";this.container.friendlyDescription="";this.container.timestamp=0}}),CharacterLoaded=Class.create(Resource,{initialize:function($super){$super();this.name="CharacterLoaded";this.container.ready=!1;this.container.timestamp=0}}),LoadManagerReference=Class.create(Resource,{initialize:function($super){$super();this.name="LoadManagerReference";
this.container.mgr=null}}),MicrophoneState=Class.create(Resource,{initialize:function($super){$super();this.name="MicrophoneState";this.container.state=!0}}),UserCommand=Class.create(Resource,{initialize:function($super){$super();this.name="UserCommand";this.container.cmd=null;this.container.timestamp=0}}),ReferralSourceUIStatus=Class.create(Resource,{initialize:function($super){$super();this.name="ReferralSourceStatus";this.container.visible=!1;this.container.timestamp=0}}),CurrentQuestionInfo=Class.create(Resource,
{initialize:function($super){$super();this.name="CurrentQuestionID";this.container.id=-1;this.container.nrOfAnswers=-1;this.container.timestamp=0}}),CurrentAnswerInfo=Class.create(Resource,{initialize:function($super){$super();this.name="CurrentAnswerID";this.container.id=-1;this.container.riskScore=0;this.container.timestamp=0}}),CharacterUserFriendlyName=Class.create(Resource,{initialize:function($super){$super();this.name="CharacterUserFriendlyName";this.container.name=""}}),UserSettings=Class.create(Resource,
{initialize:function($super){$super();this.name="UserSettings";this.container.useCharacterEyelashes=!0}}),AUValues=Class.create(Resource,{initialize:function($super){$super();this.name="AUValues";this.container.data={};for(var a=0;a<AUNames.TOTAL;++a)this.container.data[a]=0}}),CharacterAUValues=Class.create(AUValues,{initialize:function($super){$super();this.name="CharacterAUValues"}});
